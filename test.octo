:const maxShots 5
:const maxAliens 10
:const shotCooldown 7
:alias shotTimer va
:alias counter vb
:alias counter2 v9
:alias spawnTimer v7
:alias shipX vc
:alias shipY vd
:alias enemySpeed v8

# images

: imageShip
0b00111000
0b00111000
0b01111100
0b11111110

: imageAlien
0b01110000
0b11011000
0b10101000
0b11111000
0b01010000

: imageShot
0b11100000
0b11100000
0b11100000
0b00000000

: image0
0b111
0b101
0b101
0b111

0b010
0b010
0b010
0b010

0b111
0b001
0b100
0b111

0b111
0b001
0b111
0b111

0b100
0b100
0b111
0b001

0b111
0b100
0b001
0b111

0b111
0b100
0b101
0b111

0b111
0b001
0b001
0b001

0b111
0b101
0b111
0b111

0b111
0b111
0b001
0b001

: imageKills
0b10101010
0b11001010
0b10101010
0b10101011
0b01001110
0b01001000
0b01000010
0b01101110

: imageFull
0xff
0xff
0xff
0xff


# data

: controls
7 9 5

: aliens
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  

: shots
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
0 0 


: score
0

: decodedScore
0 0 0

: 0


# this is a comment it won't run!

# use these to make notes and stuff

: main
	enemySpeed := 1
	hires
	shipY := 60
	i := imageShip
	sprite shipX shipY 4

	setupa1iens
	
	loop
		v0 := 3
		delay := v0
		game1oop
		 
		v0 := delay
		loop while v0 > 0
			v0 := delay
		again
	again
;

: gameloop
	clear

	
	if spawnTimer == 0 then makeAlien
	spawnTimer += -1
	
	
	updatePlayer
	updateShots
	updateAliens	
	updateScore
	
;

: updatePlayer
	if shotTimer != 0 then shotTimer += -1
	i := controls
	load v3
	if v1 key then shipX += +2
	if v2 key then shoot
	if v0 key then shipX += -2

	i := imageShip
	sprite shipX shipY 4

;




: setupAliens
	makeAlien
;

: makeAlien

	spawnTimer := 20

	counter := 0
	loop while counter < maxAliens
		i := aliens
		i += counter
		i += counter
		load v1
		if v1 == 0 begin
			v0 := random 0b11111111
			v1 := random 0b00000011
			v1 += 1
			i := aliens
			i += counter
			i += counter
			save v1		
			;
		end
		counter += 1
	again

;


: shoot
	if shotTimer != 0 then ;
	shotTimer := shotCooldown
	counter := 0
	loop while counter < maxShots
		i := shots
		i += counter
		i += counter
		load v1
		if v1 == 0 begin
			i := shots
			i += counter
			i += counter
			v0 := shipX
			v0 += 2
			v1 := shipY
			v1 += -2
			save v1
			;
		end
		counter += 1
	again	
;

: updateShots
	counter := 0
	v3 := -2
	loop while counter < maxShots
		i := shots
		i += counter
		i += counter	
		load v1
		if v1 != 0 begin
			v1 += -2
			i := shots
			i += counter
			i += counter	
			save v1
			i := imageShot
			sprite v0 v1 3
		end
		counter += 1
	again
	

;

: updateAliens
	counter := 0
	loop while counter < maxAliens
		i := aliens
		i += counter
		i += counter	
		load v1
		if v1 != 0 begin
			
			v2 := random 0b000000010
			v2 += -1
			v0 += v2
			v1 += enemySpeed
			if v1 >= 60 then v1 := 0


			if v1 != 0 begin
				i := imageAlien
				sprite v0 v1 5
				if vf == 1 begin
					v1 := 0
					i := score
					load v0
					v0 += 1
					i := score
					save v0
				end 
			end

			i := aliens
			i += counter
			i += counter	
			save v1

		end
		counter += 1
	again
;

: updateScore
	v0 := 0
	v1 := 0
	i := imageFull
	loop while v0 < 128
		sprite v0 v1 4
		v0 += 8
	again

	
	i := imageKills
	v5 := 50
	v6 := 0
	sprite v5 v6 4
	v2 := 4
	i += v2
	v5 += 8
	sprite v5 v6 4

	v5 += 5

	
	i := score
	load v0
	i := decodedScore
	bcd v0
	counter := 0
	
	loop while counter < 3
		i := decodedScore
		i += counter
		load v0

		i := image0
		i += v0
		i += v0
		i += v0
		i += v0

		sprite v5 v6 4
		v5 += 4
		v2 := 1

		
		counter += 1
	again






;


















: setupa1iens
	counter2 := 60
	setupAliens
;

: testGlitchTable
	jump gTest
	jump gTest
	jump gTest
	jump gTest
	jump gTest
	jump gTest
	jump gTest
	jump gTest

: glitchTable
		jump g0 
		jump g1
		jump g2 
		jump g3		

: game1oop
	gameloop
	counter2 += -1
	if counter2 > 0 then ;

	i := main
	v0 := random 0b11111111
	v0 <<= v0
	v0 <<= v0
	v0 <<= v0
	i += v0
	audio
	v0 := 50
	buzzer := v0

	counter2 := 30

	i := imageShip
	v0 := random 0b11111111
	v0 <<= v0
	v0 <<= v0
	i += v0
	v0 := random 0b11111110
	i += v0
	v0 := 0xf2 
	v1 := 0x1e
	save v1

	v0 := random 0b0000011
	
	v0 <<= v0

	counter2 += v0
	counter2 += v0

	# general glitch
	

	jump0 glitchTable
	
	
; 

: gTest
	i := imageShip
	v0 := random 0b11111111
	v0 <<= v0
	v0 <<= v0
	i += v0
	v0 := random 0b11111110
	i += v0
	v0 := 0xf2 
	v1 := 0x1e
	save v1

	
	
;





: g0
	# glitch screen texture
	v0 := random 0b11111111
	v1 := random 0b11111111
	plane 2
	i := main
	i += v0
	sprite v0 v1 0
	plane 1

;

: g1
	# glitch enemy texture
	i := imageAlien
	v0 := random 0b11
	i += v0
	v0 := random 0b11111111
	save v0
;

: g2
	# speed up enemies, need to glitch
	enemySpeed += 2

;

: g3
	#glitchShip
	i := imageShip
	v0 := random 0b11111111
	v1 := random 0b11111111
	v2 := random 0b10
	i += v2
	save v1
;
